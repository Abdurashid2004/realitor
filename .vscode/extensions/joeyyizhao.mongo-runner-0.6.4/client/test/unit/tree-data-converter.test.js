const assert = require("assert");
const { singleServerData } = require("../data/mongo-tree-sample-data");
const { convertToTreeData } = require("../../src/tree-data-converter");

const expectedData = {"tree":[{"name":"Databases","type":"databases","children":[{"name":"SampleCollections","type":"database","collections":[{"name":"DBEnvyLoad_customers","type":"collection","dbName":"SampleCollections","indexes":[{"name":"{a:1}_1","type":"index","dbName":"SampleCollections","colName":"DBEnvyLoad_customers"},{"name":"\"{a:1}\"_1","type":"index","dbName":"SampleCollections","colName":"DBEnvyLoad_customers"},{"name":"a_10","type":"index","dbName":"SampleCollections","colName":"DBEnvyLoad_customers"},{"name":"b_1","type":"index","dbName":"SampleCollections","colName":"DBEnvyLoad_customers"},{"name":"c_-1","type":"index","dbName":"SampleCollections","colName":"DBEnvyLoad_customers"},{"name":"a_-1","type":"index","dbName":"SampleCollections","colName":"DBEnvyLoad_customers"}],"colName":"DBEnvyLoad_customers"},{"name":"DBEnvyLoad_orders","type":"collection","dbName":"SampleCollections","colName":"DBEnvyLoad_orders"},{"name":"DBEnvyLoad_products","type":"collection","dbName":"SampleCollections","colName":"DBEnvyLoad_products"},{"name":"GraphTest_smallGTest","type":"collection","dbName":"SampleCollections","colName":"GraphTest_smallGTest"},{"name":"Sakila_actors","type":"collection","dbName":"SampleCollections","colName":"Sakila_actors"},{"name":"Sakila_customers","type":"collection","dbName":"SampleCollections","colName":"Sakila_customers"},{"name":"Sakila_films","type":"collection","dbName":"SampleCollections","colName":"Sakila_films"},{"name":"and_sorted_test","type":"collection","dbName":"SampleCollections","colName":"and_sorted_test"},{"name":"crunchbase_database","type":"collection","dbName":"SampleCollections","colName":"crunchbase_database"},{"name":"enron_messages","type":"collection","dbName":"SampleCollections","colName":"enron_messages"},{"name":"mongomart_cart","type":"collection","dbName":"SampleCollections","colName":"mongomart_cart"},{"name":"mongomart_item","type":"collection","dbName":"SampleCollections","colName":"mongomart_item"},{"name":"samples_friends","type":"collection","dbName":"SampleCollections","colName":"samples_friends"},{"name":"samples_pokemon","type":"collection","dbName":"SampleCollections","colName":"samples_pokemon"},{"name":"savedPlans","type":"collection","dbName":"SampleCollections","colName":"savedPlans"},{"name":"video_movieDetails","type":"collection","dbName":"SampleCollections","colName":"video_movieDetails"},{"name":"video_movies","type":"collection","dbName":"SampleCollections","colName":"video_movies"},{"name":"video_reviews","type":"collection","dbName":"SampleCollections","colName":"video_reviews"}],"dbName":"SampleCollections"},{"name":"admin","type":"database","collections":[{"name":"system.roles","type":"collection","dbName":"admin","indexes":[{"name":"role_1_db_1","type":"index","dbName":"admin","colName":"system.roles"}],"colName":"system.roles"},{"name":"system.users","type":"collection","dbName":"admin","indexes":[{"name":"user_1_db_1","type":"index","dbName":"admin","colName":"system.users"}],"colName":"system.users"},{"name":"system.version","type":"collection","dbName":"admin","colName":"system.version"}],"dbName":"admin"},{"name":"config","type":"database","collections":[{"name":"system.sessions","type":"collection","dbName":"config","indexes":[{"name":"lsidTTLIndex","type":"index","dbName":"config","colName":"system.sessions"}],"colName":"system.sessions"}],"dbName":"config"},{"name":"local","type":"database","collections":[{"name":"startup_log","type":"collection","dbName":"local","colName":"startup_log"}],"dbName":"local"},{"name":"report","type":"database","collections":[{"name":"test","type":"collection","dbName":"report","indexes":[{"name":"a_1","type":"index","dbName":"report","colName":"test"}],"colName":"test"}],"dbName":"report"},{"name":"test","type":"database","collections":[{"name":"test","type":"collection","dbName":"test","indexes":[{"name":"name_1","type":"index","dbName":"test","colName":"test"}],"colName":"test"}],"dbName":"test"}]},{"name":"users","type":"users","children":[{"name":"admin.admin","user":"admin","db":"admin","type":"users"},{"name":"admin.test","user":"test","db":"admin","type":"users"}]}],"name":"localhost"};

describe("tree data converter test", () => {
  test("test data convert on single server", () => {
    const treeData = convertToTreeData(singleServerData);
    assert.deepEqual(JSON.stringify(treeData), JSON.stringify(expectedData));
  });
});
