import{_ as m,a as l}from"./table-1e4642d3.js";import{_ as c,a as r}from"./form-ef8cbf8e.js";import{_ as p}from"./dialog-dd4b0ce4.js";import{D as h,s as y,p as g,_ as f}from"./DetailDialog-9c806848.js";import{_ as u,a}from"./select-85394007.js";import{c as k,j as v}from"./codeMirror-3cc33dcd.js";import{n as _,i as b,y as x}from"./app-aaf1260a.js";import{s as w,e as o,n as S}from"./notify-d9afd13e.js";import"./checkbox-4f03e503.js";import"./scrollbar-b60f2172.js";import"./index-72d37e73.js";import"./checkbox-group-7fc9dfe8.js";import"./index-3e66c890.js";import"./switch-6bf42133.js";import"./date-picker-f3524a38.js";import"./DatabaseType-0c502678.js";import"./arrayUtil-2fb3ed04.js";import"./viewUtil-064e524b.js";import"./wrapper-101fa27b.js";import"./resultStore-5e9bef73.js";var d=(i=>(i.STRING="string",i.REJSON="ReJSON-RL",i.HASH="hash",i.LIST="list",i.ZSET="zset",i.SET="set",i.STREAM="stream",i))(d||{});const C={components:{codemirror:k,DetailDialog:h},mixins:[b],data(){return{cmOptions:{mode:"text/plain",foldGutter:!0,gutters:["CodeMirror-foldgutter"],foldOptions:void 0},itemDetail:{row:{},visible:!1},cmContent:"",language:{current:"Text",supports:["Text","JSON","Yaml"],map:{Text:"text/plain",JSON:"application/json",Yaml:"text/yaml"}},itemModel:{old:null,key:null,score:null,value:null},searchInput:"",pageIndex:1,pageSize:100,dataCount:0,remainHeight:0,keyLoading:!0,isNew:!1,key:{name:"",ttl:-1,content:null,count:null,type:null},edit:{name:"",ttl:-1,content:null},itemDialogVisiable:!1,selectStyle:{float:this.float},textrows:6}},computed:{size(){var i;return((i=this.cmContent)==null?void 0:i.length)||0},codemirror(){var i;return(i=this.$refs.cmEditor)==null?void 0:i.codemirror},isJSON(){var i;return["string","ReJSON-RL"].includes(this.key.type)&&((i=this.edit.content)==null?void 0:i.match(/^\s*[{[]/))!=null},filterData(){this.key.content||(this.key.content=[]);const i=this.searchInput,e=this.key.content.filter(t=>!i||(t.value?t.value.includes(i):t.includes(i)));return this.dataCount=this.key.count??e.length,e},dialogTitle(){const i=this.itemModel.old;switch(this.key.type){case"hash":return i?"Edit Hash":"Add to hash";case"set":return i?"Edit Set":"Add to set";case"zset":return i?"Edit ZSet":"Add to zset";case"list":return i?"Edit List":"Add to list"}return""},dynamicHeight(){return window.innerHeight-100+"px"}},mounted(){const i=()=>{const e=this.$refs.panel,t=this.$refs.stringPanel,n=this.$refs.listPanel,s=((e==null?void 0:e.clientHeight)||0)+((t==null?void 0:t.clientHeight)||0)+((n==null?void 0:n.clientHeight)||0)+16;this.remainHeight=window.innerHeight-s};i(),new ResizeObserver(i).observe(document.body),window.addEventListener("resize",i),this.on("new",({prefix:e})=>{this.isNew=!0,this.keyLoading=!1,this.language.current="Text",this.key={name:e,type:d.STRING,ttl:-1},this.edit=this.deepClone(this.key)}).on("detail",e=>{this.isNew=!1,this.keyLoading=!1,this.language.current="Text",this.pageIndex=e.page.pageNum,this.pageSize=e.page.pageSize,this.itemDialogVisiable=!1,this.key=e.res,this.edit=this.deepClone(e.res),["string","ReJSON-RL"].includes(this.key.type)&&(this.cmContent=this.edit.content),this.autoDetect()}).on("pagination",e=>{this.key.content=e}).on("msg",e=>{w(e)}).on("error",e=>{o(e)}).on("success",e=>{S({showClose:!0,duration:1500,message:e,type:"success"}),this.itemDetail.visible=!1}).on("refresh",()=>{this.refresh()}),this.emit("init"),window.addEventListener("keydown",e=>{e.key=="Escape"&&(this.itemDetail.visible=!1),x(e)&&e.code=="KeyS"&&["string","ReJSON-RL"].includes(this.key.type)&&this.update()})},methods:{changePage(i,e){this.emit("changePage",e?i:this.pageIndex+i)},autoDetect(){!this.key||!["string","ReJSON-RL"].includes(this.key.type)||this.$nextTick(()=>{this.isJSON?(this.language.current="JSON",this.format("JSON"),this.changeLanguage("JSON")):(this.language.current="Text",this.changeLanguage("Text"))})},format(i){var e;if(i=="JSON")try{const t=this.cmContent;this.cmContent=y(g((e=t==null?void 0:t.replace)==null?void 0:e.call(t,/Â /g," ")),null,2)}catch(t){console.log(t)}},changeLanguage(i){if(!this.codemirror)return;const e=this.language.map[i];this.codemirror.setOption("mode",e),this.codemirror.setOption("foldOptions",i=="JSON"?v(this.codemirror):void 0)},refresh(){this.itemDialogVisiable=!1,this.emit("refresh",{key:this.key})},saveItem(){if(!this.edit.name)return o("Key name cannot be null!");this.emit("saveItem",{...this.itemModel,keyName:this.edit.name,type:this.key.type})},showOpenDialog(){this.itemModel={},this.itemDialogVisiable=!0},showEditDialog(i){this.itemModel={...i,old:{...i}},this.itemDialogVisiable=!0},showDetailDialog(i){this.itemModel={...i,old:{...i}},this.itemDetail.row=i,this.itemDetail.visible=!0},saveValue(i){this.itemModel.value=i,this.saveItem()},deleteLine(i){this.$confirm("Are you sure to delete this key?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then(()=>{this.emit("deleteLine",i)})},deleteKey(){this.$confirm("Are you sure to delete this key?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then(()=>{this.emit("del",{key:{name:this.key.name}}),this.key={},this.edit={}})},rename(){console.log(this.key.name),this.emit("rename",{key:{name:this.key.name,newName:this.edit.name}})},ttlKey(){this.emit("ttl",{key:{name:this.key.name,ttl:this.edit.ttl}})},update(){if(!this.edit.name)return o("Key name cannot be null!");this.emit("update",{key:{name:this.key.name,newName:this.edit.name,type:this.key.type,ttl:this.edit.ttl,content:this.cmContent}})},deepClone(i){let e=Array.isArray(i)?[]:{};if(i&&typeof i=="object")for(let t in i)i.hasOwnProperty(t)&&(i[t]&&typeof i[t]=="object"?e[t]=this.deepClone(i[t]):e[t]=i[t]);return e}}};var z=function(){var e=this,t=e._self._c;return t("div",{staticClass:"redis-view-container"},[e.keyLoading?t("div",{staticStyle:{"text-align":"center"}},[e._v(" loading ")]):t("div",{staticClass:"key-tab-container"},[t("div",{ref:"panel",staticClass:"flex pt-2 pb-4 justify-between pr-4 flex-wrap gap-3"},[t("div",[t("vsc-input",{ref:"keyNameInput",staticStyle:{width:"500px"},attrs:{size:"mini",placeholder:"Please input key name"},nativeOn:{keyup:function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"enter",13,n.key,"Enter")?null:e.rename.apply(null,arguments)}},scopedSlots:e._u([{key:"prepend",fn:function(){return[e.isNew?t(u,{staticStyle:{width:"100px"},attrs:{placeholder:"Forever",size:"small"},model:{value:e.key.type,callback:function(n){e.$set(e.key,"type",n)},expression:"key.type"}},[t(a,{attrs:{value:"string",label:"STRING"}}),t(a,{attrs:{value:"list",label:"LIST"}}),t(a,{attrs:{value:"set",label:"SET"}}),t(a,{attrs:{value:"zset",label:"ZSET"}}),t(a,{attrs:{value:"hash",label:"HASH"}}),t(a,{attrs:{value:"stream",label:"STREAM"}})],1):t("span",{staticClass:"key-detail-type"},[e._v(e._s(e.key.type))])]},proxy:!0}]),model:{value:e.edit.name,callback:function(n){e.$set(e.edit,"name",n)},expression:"edit.name"}}),e.isNew?e._e():t("vsc-button",{staticClass:"inline btn-ad",attrs:{size:"medium",icon:"el-icon-check"},on:{click:e.rename}})],1),t("div",[t("vsc-input",{staticStyle:{width:"220px"},attrs:{type:"number",size:"mini"},nativeOn:{keyup:function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"enter",13,n.key,"Enter")?null:e.ttlKey.apply(null,arguments)}},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("span",[e._v("TTL")])]},proxy:!0}]),model:{value:e.edit.ttl,callback:function(n){e.$set(e.edit,"ttl",n)},expression:"edit.ttl"}}),t("vsc-button",{staticClass:"inline btn-ad",attrs:{size:"medium",icon:"el-icon-check"},on:{click:e.ttlKey}}),t("vsc-button",{staticClass:"inline btn-ad",attrs:{size:"medium",icon:"el-icon-delete"},on:{click:e.deleteKey}},[e._v("Delete")]),t("vsc-button",{staticClass:"inline btn-ad",attrs:{size:"medium",icon:"el-icon-refresh"},on:{click:e.refresh}},[e._v("Refresh")])],1)]),["string","ReJSON-RL"].includes(e.key.type)?t("div",{ref:"stringPanel",staticClass:"flex pr-4 mb-2 gap-x-7"},[t("div",[e._v(" Size: "+e._s(e.size)+" Bytes ")]),["string","ReJSON-RL"].includes(e.key.type)?t("div",[t(u,{staticClass:"mr-2",staticStyle:{width:"145px"},attrs:{placeholder:"Default",size:"small"},on:{change:e.changeLanguage},model:{value:e.language.current,callback:function(n){e.$set(e.language,"current",n)},expression:"language.current"}},e._l(e.language.supports,function(n){return t(a,{key:n,attrs:{value:n}},[e._v(e._s(n))])}),1),t("vsc-button",{staticClass:"inline btn-ad",staticStyle:{height:"27px"},on:{click:e.update}},[e._v("Save")])],1):e._e()]):e._e(),t(c,{directives:[{name:"show",rawName:"v-show",value:["string","ReJSON-RL"].includes(e.key.type),expression:"['string','ReJSON-RL'].includes(key.type)"}]},[t("div",{staticClass:"value-panel"},[t("codemirror",{ref:"cmEditor",staticClass:"json-panel",style:"height:"+e.remainHeight+"px",attrs:{options:e.cmOptions},model:{value:e.cmContent,callback:function(n){e.cmContent=n},expression:"cmContent"}})],1)]),e.key.type=="list"||e.key.type=="set"||e.key.type=="zset"||e.key.type=="hash"||e.key.type=="stream"?t("div",[t("div",{ref:"listPanel"},[t("vsc-input",{staticClass:"filter-input mb-2",staticStyle:{width:"200px"},attrs:{size:"mini",placeholder:e.$t("result.searchNotice"),clearable:!0},model:{value:e.searchInput,callback:function(n){e.searchInput=n},expression:"searchInput"}}),t("vsc-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"Add new key",placement:"bottom-start"}},[t("div",{staticClass:"ml-2 inline-block"},[e.key.type!="stream"?t("vsc-button",{staticStyle:{color:"var(--vscode-terminal-ansiYellow)"},attrs:{type:"icon",icon:"codicon-add text-lg"},on:{click:function(n){return e.showOpenDialog()}}}):e._e()],1)]),t(f,{staticStyle:{display:"inline-block"},attrs:{small:!0,total:e.dataCount,"page-size":e.pageSize,"current-page":e.pageIndex,"page-sizes":[20,50,100,200,300],layout:"prev,pager, next, total",background:""},on:{"update:pageSize":function(n){e.pageSize=n},"update:page-size":function(n){e.pageSize=n},"update:currentPage":function(n){e.pageIndex=n},"update:current-page":function(n){e.pageIndex=n},"current-change":n=>e.changePage(n,!0),"next-click":()=>e.changePage(1),"prev-click":()=>e.changePage(-1)}}),t(p,{attrs:{title:e.dialogTitle,visible:e.itemDialogVisiable,closeOnClickModal:!1,width:"30%","custom-class":"new-item-dialog"},on:{"update:visible":function(n){e.itemDialogVisiable=n}},scopedSlots:e._u([{key:"footer",fn:function(){return[t("vsc-button",{attrs:{type:"secondary"},on:{click:function(n){e.itemDialogVisiable=!1}}},[e._v(e._s(e.$t("common.cancel")))]),t("vsc-button",{attrs:{type:"primary"},on:{click:e.saveItem}},[e._v("Confirm")])]},proxy:!0}],null,!1,812617034)},[t(c,{attrs:{"label-width":"60px"}},[e.key.type=="hash"?t(r,{attrs:{label:"key"}},[t("vsc-input",{attrs:{size:"mini"},model:{value:e.itemModel.key,callback:function(n){e.$set(e.itemModel,"key",n)},expression:"itemModel.key"}})],1):e._e(),e.key.type=="zset"?t(r,{attrs:{label:"score"}},[t("vsc-input",{attrs:{size:"mini"},model:{value:e.itemModel.score,callback:function(n){e.$set(e.itemModel,"score",n)},expression:"itemModel.score"}})],1):e._e(),t(r,{attrs:{label:"value"}},[t("vsc-input",{attrs:{size:"mini"},model:{value:e.itemModel.value,callback:function(n){e.$set(e.itemModel,"value",n)},expression:"itemModel.value"}})],1)],1)],1)],1),t("div",[t(m,{attrs:{data:e.filterData,height:e.remainHeight,border:"","header-cell-style":{padding:0}}},[t(l,{attrs:{type:"index",label:"Index",sortable:"",width:"60",align:"center"}}),e.key.type=="hash"?t(l,{attrs:{"sort-by":"key",resizable:"",sortable:"",label:"Key",align:"center",width:"200",prop:"key"}}):e._e(),e.key.type=="zset"?t(l,{attrs:{"sort-by":"score",resizable:"",sortable:"",label:"Score",align:"center",width:"200",prop:"score"}}):e._e(),e.key.type=="stream"?t(l,{attrs:{"sort-by":"id",resizable:"",sortable:"",label:"id",align:"center",width:"200",prop:"id"}}):e._e(),t(l,{attrs:{"sort-by":"value",resizable:"",sortable:"",label:"Value",align:"center"},scopedSlots:e._u([{key:"default",fn:function(n){var s;return[t("span",{staticClass:"item-value",attrs:{title:n.row.value},domProps:{textContent:e._s(((s=n.row)==null?void 0:s.value)||n.row)}})]}}],null,!1,2382774844)}),t(l,{attrs:{label:"Operation",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(n){return[["hash","set","zset","stream"].includes(e.key.type)?t("vsc-button",{attrs:{type:"icon",icon:"codicon-zoom-in",title:"View On Dialog"},on:{click:function(s){return e.showDetailDialog(n.row)}}}):e._e(),["hash","set","zset"].includes(e.key.type)?t("vsc-button",{staticStyle:{color:"var(--vscode-terminal-ansiYellow)"},attrs:{type:"icon",icon:"codicon-edit text-base",title:"edit"},on:{click:function(s){return e.showEditDialog(n.row)}}}):e._e(),t("vsc-button",{staticClass:"ml-3",staticStyle:{color:"#f56c6c"},attrs:{type:"icon",icon:"el-icon-delete text-base",title:"delete"},on:{click:function(s){return e.deleteLine(n.row)}}})]}}],null,!1,1228634269)})],1)],1)]):e._e()],1),t("DetailDialog",{attrs:{visible:e.itemDetail.visible,modal:!0,editable:!0,data:e.itemDetail.row.value},on:{"update:visible":function(n){return e.$set(e.itemDetail,"visible",n)},save:e.saveValue}})],1)},O=[],D=_(C,z,O,!1,null,"4e6321f2",null,null);const j=D.exports;export{j as default};
